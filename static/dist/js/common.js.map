{
  "version": 3,
  "sources": ["../../js/common.js"],
  "sourcesContent": ["// common.js\r\n// Utility helpers shared across the app.\r\n\r\n// Get CSRF token from cookie (Django default)\r\nfunction getCookie(name) {\r\n  let cookieValue = null;\r\n  if (document.cookie && document.cookie !== '') {\r\n    const cookies = document.cookie.split(';');\r\n    for (let i = 0; i < cookies.length; i++) {\r\n      const cookie = cookies[i].trim();\r\n      if (cookie.substring(0, name.length + 1) === (name + '=')) {\r\n        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));\r\n        break;\r\n      }\r\n    }\r\n  }\r\n  return cookieValue;\r\n}\r\n\r\n// Toggle dropdowns by id\r\nfunction toggleDropdown(elementId) {\r\n  const el = document.getElementById(elementId);\r\n  if (!el) return;\r\n  el.classList.toggle('hidden');\r\n}\r\n\r\n// Toast queue and centered placement to avoid overlapping header dropdown\r\nconst __toastQueue = [];\r\nlet __toastActive = false;\r\n\r\nfunction __getToastContainer(){\r\n  let c = document.getElementById('toastContainer');\r\n  if (!c){\r\n    c = document.createElement('div');\r\n    c.id = 'toastContainer';\r\n    c.className = 'fixed top-4 left-0 right-0 z-50 flex justify-center items-start pointer-events-none';\r\n    document.body.appendChild(c);\r\n  }\r\n  return c;\r\n}\r\n\r\nfunction __renderToast(message, type, details){\r\n  let color = 'bg-blue-600';\r\n  let icon = '\u2139\uFE0F';\r\n  if (type === 'success') { color = 'bg-green-600'; icon = '\u2714\uFE0F'; }\r\n  if (type === 'error') { color = 'bg-red-600'; icon = '\u26A0\uFE0F'; }\r\n  const wrapper = document.createElement('div');\r\n  wrapper.className = 'pointer-events-auto';\r\n  const div = document.createElement('div');\r\n  div.setAttribute('role', 'status');\r\n  div.setAttribute('aria-live', 'polite');\r\n  div.className = `${color} text-white px-4 py-3 rounded shadow-lg max-w-sm w-[min(92vw,28rem)]`; // centered card\r\n  div.innerHTML = `\r\n    <div class=\"flex items-start gap-2\">\r\n      <span class=\"text-lg leading-none\">${icon}</span>\r\n      <div class=\"flex-1\">\r\n        <div class=\"font-medium\">${message}</div>\r\n        ${details ? `<div class=\"opacity-90 text-sm mt-0.5\">${details}</div>` : ''}\r\n      </div>\r\n    </div>`;\r\n  // animation\r\n  wrapper.style.transition = 'transform 220ms ease, opacity 220ms ease';\r\n  wrapper.style.transform = 'translateY(-10px)';\r\n  wrapper.style.opacity = '0';\r\n  const container = __getToastContainer();\r\n  container.appendChild(wrapper);\r\n  wrapper.appendChild(div);\r\n  // enter\r\n  requestAnimationFrame(() => {\r\n    wrapper.style.transform = 'translateY(0)';\r\n    wrapper.style.opacity = '1';\r\n  });\r\n  const timeout = setTimeout(() => __dismissToast(wrapper), 3000);\r\n  wrapper.addEventListener('click', () => {\r\n    clearTimeout(timeout);\r\n    __dismissToast(wrapper);\r\n  });\r\n}\r\n\r\nfunction __dismissToast(wrapper){\r\n  wrapper.style.transform = 'translateY(-10px)';\r\n  wrapper.style.opacity = '0';\r\n  setTimeout(() => {\r\n    wrapper.remove();\r\n    __toastActive = false;\r\n    __drainToastQueue();\r\n  }, 220);\r\n}\r\n\r\nfunction __drainToastQueue(){\r\n  if (__toastActive) return;\r\n  const next = __toastQueue.shift();\r\n  if (!next) return;\r\n  __toastActive = true;\r\n  __renderToast(next.message, next.type, next.details);\r\n}\r\n\r\n// Simple notification banner with optional details (public API)\r\nfunction showNotification(message, type = 'info', details = '') {\r\n  __toastQueue.push({ message, type, details });\r\n  __drainToastQueue();\r\n}\r\n\r\nwindow.getCookie = getCookie;\r\nwindow.toggleDropdown = toggleDropdown;\r\nwindow.showNotification = showNotification;\r\n\r\n// Lightweight global loading indicator (top progress bar)\r\nlet __loadingCount = 0;\r\nlet __loadingTimer = null;\r\nfunction __ensureProgressBar(){\r\n  let bar = document.getElementById('globalProgressBar');\r\n  if (!bar){\r\n    bar = document.createElement('div');\r\n    bar.id = 'globalProgressBar';\r\n    bar.className = 'fixed top-0 left-0 h-0.5 bg-blue-600 dark:bg-blue-400 z-[60] transition-[width,opacity] duration-300 ease-out';\r\n    bar.style.width = '0%';\r\n    bar.style.opacity = '0';\r\n    document.body.appendChild(bar);\r\n  }\r\n  return bar;\r\n}\r\nfunction startLoading(){\r\n  const bar = __ensureProgressBar();\r\n  __loadingCount++;\r\n  if (__loadingCount === 1){\r\n    // reset and start animating to 80%\r\n    bar.style.opacity = '1';\r\n    bar.style.width = '0%';\r\n    // small delay to allow CSS to register width reset\r\n    requestAnimationFrame(()=>{\r\n      bar.style.width = '80%';\r\n    });\r\n    // safety timer to avoid hanging bar\r\n    if (__loadingTimer) clearTimeout(__loadingTimer);\r\n    __loadingTimer = setTimeout(()=>{ bar.style.width = '90%'; }, 4000);\r\n  }\r\n}\r\nfunction stopLoading(){\r\n  const bar = __ensureProgressBar();\r\n  __loadingCount = Math.max(0, __loadingCount - 1);\r\n  if (__loadingCount === 0){\r\n    if (__loadingTimer) { clearTimeout(__loadingTimer); __loadingTimer = null; }\r\n    // finish to 100% then fade out\r\n    bar.style.width = '100%';\r\n    setTimeout(()=>{ bar.style.opacity = '0'; }, 200);\r\n    setTimeout(()=>{ bar.style.width = '0%'; }, 600);\r\n  }\r\n}\r\nasync function withLoading(promise){\r\n  try { startLoading(); return await promise; } finally { stopLoading(); }\r\n}\r\n\r\nwindow.startLoading = startLoading;\r\nwindow.stopLoading = stopLoading;\r\nwindow.withLoading = withLoading;\r\n\r\n// Intercept logout form to use AJAX endpoint and redirect cleanly\r\ndocument.addEventListener('DOMContentLoaded', () => {\r\n  const form = document.getElementById('logoutForm');\r\n  if (form) {\r\n    form.addEventListener('submit', async (e) => {\r\n      e.preventDefault();\r\n      try {\r\n        const res = await fetch(form.getAttribute('action') || '/logout/', { method: 'POST', headers: { 'X-CSRFToken': getCookie('csrftoken') } });\r\n        const data = await res.json();\r\n        window.location.href = (data && data.redirect) ? data.redirect : '/login/';\r\n      } catch (err) {\r\n        window.location.href = '/login/';\r\n      }\r\n    });\r\n  }\r\n});\r\n\r\n// Unique ID generation (5-char alphanumeric) and persistent mapping\r\nfunction generateUniqueID() {\r\n  const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';\r\n  let result = '';\r\n  for (let i = 0; i < 5; i++) {\r\n    result += chars.charAt(Math.floor(Math.random() * chars.length));\r\n  }\r\n  return result;\r\n}\r\n\r\nfunction _loadUidMap(){\r\n  try { return JSON.parse(localStorage.getItem('uidMap') || '{}'); } catch { return {}; }\r\n}\r\n\r\nfunction _saveUidMap(map){\r\n  try { localStorage.setItem('uidMap', JSON.stringify(map)); } catch {}\r\n}\r\n\r\n// Returns persistent UID for a stable key; generates if missing and guarantees uniqueness within the map\r\nfunction getPersistentUID(stableKey){\r\n  const map = _loadUidMap();\r\n  if (map[stableKey]) return map[stableKey];\r\n  let candidate = generateUniqueID();\r\n  const values = new Set(Object.values(map));\r\n  while (values.has(candidate)) candidate = generateUniqueID();\r\n  map[stableKey] = candidate;\r\n  _saveUidMap(map);\r\n  return candidate;\r\n}\r\n\r\nwindow.generateUniqueID = generateUniqueID;\r\nwindow.getPersistentUID = getPersistentUID;\r\n\r\n\r\n// Wrapper around fetch that injects Django CSRF header for same-origin, non-GET requests\r\nasync function fetchWithCSRF(input, init){\r\n  init = init || {};\r\n  const method = (init.method || 'GET').toUpperCase();\r\n  const isSafe = method === 'GET' || method === 'HEAD' || method === 'OPTIONS' || method === 'TRACE';\r\n  const url = (typeof input === 'string') ? input : (input && input.url) || '';\r\n  const isSameOrigin = !/^https?:\\/\\//i.test(url) || url.indexOf(location.origin) === 0;\r\n  if (isSameOrigin && !isSafe){\r\n    init.headers = init.headers || {};\r\n    // Determine token with fallbacks (cookie -> meta[name=\"csrf-token\"] -> #csrf-token-global)\r\n    var token = (function(){\r\n      try { var c = getCookie('csrftoken'); if (c) return c; } catch(_){ }\r\n      try { var m = document.querySelector('meta[name=\"csrf-token\"]'); if (m && (m.content||'').trim()) return m.content.trim(); } catch(_){ }\r\n      try { var h = document.getElementById('csrf-token-global'); if (h && (h.value||h.content)) return (h.value||h.content); } catch(_){ }\r\n      return '';\r\n    })();\r\n    if (!(init.headers instanceof Headers)){\r\n      // Plain object, safe to mutate\r\n      if (!init.headers['X-CSRFToken'] && token) init.headers['X-CSRFToken'] = token;\r\n      if (!init.headers['X-Requested-With']) init.headers['X-Requested-With'] = 'XMLHttpRequest';\r\n    } else {\r\n      if (!init.headers.has('X-CSRFToken') && token) init.headers.set('X-CSRFToken', token);\r\n      if (!init.headers.has('X-Requested-With')) init.headers.set('X-Requested-With', 'XMLHttpRequest');\r\n    }\r\n    init.credentials = init.credentials || 'same-origin';\r\n  }\r\n  return fetch(input, init);\r\n}\r\n\r\nwindow.fetchWithCSRF = fetchWithCSRF;\r\n\r\n"],
  "mappings": "MAIA,SAASA,EAAUC,EAAM,CACvB,IAAIC,EAAc,KAClB,GAAI,SAAS,QAAU,SAAS,SAAW,GAAI,CAC7C,IAAMC,EAAU,SAAS,OAAO,MAAM,GAAG,EACzC,QAASC,EAAI,EAAGA,EAAID,EAAQ,OAAQC,IAAK,CACvC,IAAMC,EAASF,EAAQC,CAAC,EAAE,KAAK,EAC/B,GAAIC,EAAO,UAAU,EAAGJ,EAAK,OAAS,CAAC,IAAOA,EAAO,IAAM,CACzDC,EAAc,mBAAmBG,EAAO,UAAUJ,EAAK,OAAS,CAAC,CAAC,EAClE,KACF,CACF,CACF,CACA,OAAOC,CACT,CAGA,SAASI,EAAeC,EAAW,CACjC,IAAMC,EAAK,SAAS,eAAeD,CAAS,EACvCC,GACLA,EAAG,UAAU,OAAO,QAAQ,CAC9B,CAGA,IAAMC,EAAe,CAAC,EAClBC,EAAgB,GAEpB,SAASC,GAAqB,CAC5B,IAAIC,EAAI,SAAS,eAAe,gBAAgB,EAChD,OAAKA,IACHA,EAAI,SAAS,cAAc,KAAK,EAChCA,EAAE,GAAK,iBACPA,EAAE,UAAY,sFACd,SAAS,KAAK,YAAYA,CAAC,GAEtBA,CACT,CAEA,SAASC,EAAcC,EAASC,EAAMC,EAAQ,CAC5C,IAAIC,EAAQ,cACRC,EAAO,eACPH,IAAS,YAAaE,EAAQ,eAAgBC,EAAO,gBACrDH,IAAS,UAAWE,EAAQ,aAAcC,EAAO,gBACrD,IAAMC,EAAU,SAAS,cAAc,KAAK,EAC5CA,EAAQ,UAAY,sBACpB,IAAMC,EAAM,SAAS,cAAc,KAAK,EACxCA,EAAI,aAAa,OAAQ,QAAQ,EACjCA,EAAI,aAAa,YAAa,QAAQ,EACtCA,EAAI,UAAY,GAAGH,CAAK,uEACxBG,EAAI,UAAY;AAAA;AAAA,2CAEyBF,CAAI;AAAA;AAAA,mCAEZJ,CAAO;AAAA,UAChCE,EAAU,0CAA0CA,CAAO,SAAW,EAAE;AAAA;AAAA,YAIhFG,EAAQ,MAAM,WAAa,2CAC3BA,EAAQ,MAAM,UAAY,oBAC1BA,EAAQ,MAAM,QAAU,IACNR,EAAoB,EAC5B,YAAYQ,CAAO,EAC7BA,EAAQ,YAAYC,CAAG,EAEvB,sBAAsB,IAAM,CAC1BD,EAAQ,MAAM,UAAY,gBAC1BA,EAAQ,MAAM,QAAU,GAC1B,CAAC,EACD,IAAME,EAAU,WAAW,IAAMC,EAAeH,CAAO,EAAG,GAAI,EAC9DA,EAAQ,iBAAiB,QAAS,IAAM,CACtC,aAAaE,CAAO,EACpBC,EAAeH,CAAO,CACxB,CAAC,CACH,CAEA,SAASG,EAAeH,EAAQ,CAC9BA,EAAQ,MAAM,UAAY,oBAC1BA,EAAQ,MAAM,QAAU,IACxB,WAAW,IAAM,CACfA,EAAQ,OAAO,EACfT,EAAgB,GAChBa,EAAkB,CACpB,EAAG,GAAG,CACR,CAEA,SAASA,GAAmB,CAC1B,GAAIb,EAAe,OACnB,IAAMc,EAAOf,EAAa,MAAM,EAC3Be,IACLd,EAAgB,GAChBG,EAAcW,EAAK,QAASA,EAAK,KAAMA,EAAK,OAAO,EACrD,CAGA,SAASC,EAAiBX,EAASC,EAAO,OAAQC,EAAU,GAAI,CAC9DP,EAAa,KAAK,CAAE,QAAAK,EAAS,KAAAC,EAAM,QAAAC,CAAQ,CAAC,EAC5CO,EAAkB,CACpB,CAEA,OAAO,UAAYvB,EACnB,OAAO,eAAiBM,EACxB,OAAO,iBAAmBmB,EAG1B,IAAIC,EAAiB,EACjBC,EAAiB,KACrB,SAASC,GAAqB,CAC5B,IAAIC,EAAM,SAAS,eAAe,mBAAmB,EACrD,OAAKA,IACHA,EAAM,SAAS,cAAc,KAAK,EAClCA,EAAI,GAAK,oBACTA,EAAI,UAAY,gHAChBA,EAAI,MAAM,MAAQ,KAClBA,EAAI,MAAM,QAAU,IACpB,SAAS,KAAK,YAAYA,CAAG,GAExBA,CACT,CACA,SAASC,GAAc,CACrB,IAAMD,EAAMD,EAAoB,EAChCF,IACIA,IAAmB,IAErBG,EAAI,MAAM,QAAU,IACpBA,EAAI,MAAM,MAAQ,KAElB,sBAAsB,IAAI,CACxBA,EAAI,MAAM,MAAQ,KACpB,CAAC,EAEGF,GAAgB,aAAaA,CAAc,EAC/CA,EAAiB,WAAW,IAAI,CAAEE,EAAI,MAAM,MAAQ,KAAO,EAAG,GAAI,EAEtE,CACA,SAASE,GAAa,CACpB,IAAMF,EAAMD,EAAoB,EAChCF,EAAiB,KAAK,IAAI,EAAGA,EAAiB,CAAC,EAC3CA,IAAmB,IACjBC,IAAkB,aAAaA,CAAc,EAAGA,EAAiB,MAErEE,EAAI,MAAM,MAAQ,OAClB,WAAW,IAAI,CAAEA,EAAI,MAAM,QAAU,GAAK,EAAG,GAAG,EAChD,WAAW,IAAI,CAAEA,EAAI,MAAM,MAAQ,IAAM,EAAG,GAAG,EAEnD,CACA,eAAeG,EAAYC,EAAQ,CACjC,GAAI,CAAE,OAAAH,EAAa,EAAU,MAAMG,CAAS,QAAE,CAAUF,EAAY,CAAG,CACzE,CAEA,OAAO,aAAeD,EACtB,OAAO,YAAcC,EACrB,OAAO,YAAcC,EAGrB,SAAS,iBAAiB,mBAAoB,IAAM,CAClD,IAAME,EAAO,SAAS,eAAe,YAAY,EAC7CA,GACFA,EAAK,iBAAiB,SAAU,MAAOC,GAAM,CAC3CA,EAAE,eAAe,EACjB,GAAI,CAEF,IAAMC,EAAO,MADD,MAAM,MAAMF,EAAK,aAAa,QAAQ,GAAK,WAAY,CAAE,OAAQ,OAAQ,QAAS,CAAE,cAAelC,EAAU,WAAW,CAAE,CAAE,CAAC,GAClH,KAAK,EAC5B,OAAO,SAAS,KAAQoC,GAAQA,EAAK,SAAYA,EAAK,SAAW,SACnE,MAAc,CACZ,OAAO,SAAS,KAAO,SACzB,CACF,CAAC,CAEL,CAAC,EAGD,SAASC,GAAmB,CAC1B,IAAMC,EAAQ,uCACVC,EAAS,GACb,QAASnC,EAAI,EAAGA,EAAI,EAAGA,IACrBmC,GAAUD,EAAM,OAAO,KAAK,MAAM,KAAK,OAAO,EAAIA,EAAM,MAAM,CAAC,EAEjE,OAAOC,CACT,CAEA,SAASC,GAAa,CACpB,GAAI,CAAE,OAAO,KAAK,MAAM,aAAa,QAAQ,QAAQ,GAAK,IAAI,CAAG,MAAQ,CAAE,MAAO,CAAC,CAAG,CACxF,CAEA,SAASC,EAAYC,EAAI,CACvB,GAAI,CAAE,aAAa,QAAQ,SAAU,KAAK,UAAUA,CAAG,CAAC,CAAG,MAAQ,CAAC,CACtE,CAGA,SAASC,EAAiBC,EAAU,CAClC,IAAMF,EAAMF,EAAY,EACxB,GAAIE,EAAIE,CAAS,EAAG,OAAOF,EAAIE,CAAS,EACxC,IAAIC,EAAYR,EAAiB,EAC3BS,EAAS,IAAI,IAAI,OAAO,OAAOJ,CAAG,CAAC,EACzC,KAAOI,EAAO,IAAID,CAAS,GAAGA,EAAYR,EAAiB,EAC3D,OAAAK,EAAIE,CAAS,EAAIC,EACjBJ,EAAYC,CAAG,EACRG,CACT,CAEA,OAAO,iBAAmBR,EAC1B,OAAO,iBAAmBM,EAI1B,eAAeI,EAAcC,EAAOC,EAAK,CACvCA,EAAOA,GAAQ,CAAC,EAChB,IAAMC,GAAUD,EAAK,QAAU,OAAO,YAAY,EAC5CE,EAASD,IAAW,OAASA,IAAW,QAAUA,IAAW,WAAaA,IAAW,QACrFE,EAAO,OAAOJ,GAAU,SAAYA,EAASA,GAASA,EAAM,KAAQ,GAE1E,IADqB,CAAC,gBAAgB,KAAKI,CAAG,GAAKA,EAAI,QAAQ,SAAS,MAAM,IAAM,IAChE,CAACD,EAAO,CAC1BF,EAAK,QAAUA,EAAK,SAAW,CAAC,EAEhC,IAAII,GAAS,UAAU,CACrB,GAAI,CAAE,IAAIzC,EAAIZ,EAAU,WAAW,EAAG,GAAIY,EAAG,OAAOA,CAAG,MAAU,CAAE,CACnE,GAAI,CAAE,IAAI0C,EAAI,SAAS,cAAc,yBAAyB,EAAG,GAAIA,IAAMA,EAAE,SAAS,IAAI,KAAK,EAAG,OAAOA,EAAE,QAAQ,KAAK,CAAG,MAAU,CAAE,CACvI,GAAI,CAAE,IAAIC,EAAI,SAAS,eAAe,mBAAmB,EAAG,GAAIA,IAAMA,EAAE,OAAOA,EAAE,SAAU,OAAQA,EAAE,OAAOA,EAAE,OAAU,MAAU,CAAE,CACpI,MAAO,EACT,GAAG,EACGN,EAAK,mBAAmB,SAKxB,CAACA,EAAK,QAAQ,IAAI,aAAa,GAAKI,GAAOJ,EAAK,QAAQ,IAAI,cAAeI,CAAK,EAC/EJ,EAAK,QAAQ,IAAI,kBAAkB,GAAGA,EAAK,QAAQ,IAAI,mBAAoB,gBAAgB,IAJ5F,CAACA,EAAK,QAAQ,aAAa,GAAKI,IAAOJ,EAAK,QAAQ,aAAa,EAAII,GACpEJ,EAAK,QAAQ,kBAAkB,IAAGA,EAAK,QAAQ,kBAAkB,EAAI,mBAK5EA,EAAK,YAAcA,EAAK,aAAe,aACzC,CACA,OAAO,MAAMD,EAAOC,CAAI,CAC1B,CAEA,OAAO,cAAgBF",
  "names": ["getCookie", "name", "cookieValue", "cookies", "i", "cookie", "toggleDropdown", "elementId", "el", "__toastQueue", "__toastActive", "__getToastContainer", "c", "__renderToast", "message", "type", "details", "color", "icon", "wrapper", "div", "timeout", "__dismissToast", "__drainToastQueue", "next", "showNotification", "__loadingCount", "__loadingTimer", "__ensureProgressBar", "bar", "startLoading", "stopLoading", "withLoading", "promise", "form", "e", "data", "generateUniqueID", "chars", "result", "_loadUidMap", "_saveUidMap", "map", "getPersistentUID", "stableKey", "candidate", "values", "fetchWithCSRF", "input", "init", "method", "isSafe", "url", "token", "m", "h"]
}
