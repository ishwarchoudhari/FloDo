{
  "version": 3,
  "sources": ["../../js/portal_base.js"],
  "sourcesContent": ["/*\nClient Portal base enhancements (no backend changes)\n- Theme toggle (persists to localStorage)\n- Mobile menu toggling\n- WebSocket notifications indicator (uses existing /ws/notifications/)\n- Basic AJAX helper (fetch wrapper) reserved for future use\nSecurity-conscious: no inline eval, no third-party origins beyond existing Tailwind CDN already in templates.\n*/\n(function () {\n  function qs(sel, ctx) { return (ctx || document).querySelector(sel); }\n  function qsa(sel, ctx) { return Array.from((ctx || document).querySelectorAll(sel)); }\n\n  // Theme toggle\n  function setTheme(mode) {\n    try {\n      if (mode === 'dark') document.documentElement.classList.add('dark');\n      else document.documentElement.classList.remove('dark');\n      localStorage.setItem('theme', mode);\n    } catch (_) {}\n  }\n\n  // User dropdown menus (desktop + mobile)\n  function initUserMenu(){\n    var btn = qs('#user-menu-btn');\n    var panel = qs('#user-menu-panel');\n    var btnM = qs('#user-menu-btn-mobile');\n    var panelM = qs('#user-menu-panel-mobile');\n    function toggle(el){ if (!el) return; el.classList.toggle('hidden'); }\n    function open(el){ if (!el) return; el.classList.remove('hidden'); }\n    function close(el){ if (!el) return; el.classList.add('hidden'); }\n    if (btn && panel){\n      btn.addEventListener('click', function(e){ e.preventDefault(); e.stopPropagation(); toggle(panel); btn.setAttribute('aria-expanded', String(!panel.classList.contains('hidden'))); });\n    }\n    if (btnM && panelM){\n      btnM.addEventListener('click', function(e){ e.preventDefault(); e.stopPropagation(); toggle(panelM); btnM.setAttribute('aria-expanded', String(!panelM.classList.contains('hidden'))); });\n    }\n    document.addEventListener('click', function(e){\n      var t = e.target;\n      if (panel && !panel.contains(t) && btn && !btn.contains(t)) close(panel);\n      if (panelM && !panelM.contains(t) && btnM && !btnM.contains(t)) close(panelM);\n    });\n    document.addEventListener('keydown', function(e){ if (e.key === 'Escape'){ close(panel); close(panelM); } });\n  }\n  function currentTheme() {\n    try {\n      var t = localStorage.getItem('theme');\n      if (t === 'dark' || t === 'light') return t;\n      // Fallback to media query\n      if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) return 'dark';\n    } catch (_) {}\n    return 'light';\n  }\n\n  function initThemeToggle() {\n    var btn = qs('#btn-theme');\n    if (!btn) return;\n    btn.addEventListener('click', function () {\n      var next = currentTheme() === 'dark' ? 'light' : 'dark';\n      setTheme(next);\n      // swap icons\n      try {\n        qs('#icon-sun') && (qs('#icon-sun').style.display = (next === 'dark' ? '' : 'none'));\n        qs('#icon-moon') && (qs('#icon-moon').style.display = (next === 'dark' ? 'none' : ''));\n      } catch (_) {}\n    });\n  }\n\n  // Mobile menu toggle\n  function initMobileMenu() {\n    var btn = qs('#btn-mobile');\n    var menu = qs('#mobile-nav');\n    if (!btn || !menu) return;\n    btn.addEventListener('click', function () {\n      var hidden = menu.classList.contains('hidden');\n      if (hidden) menu.classList.remove('hidden'); else menu.classList.add('hidden');\n    });\n  }\n\n  // WebSocket notifications (Channels routing: /ws/notifications/)\n  function initNotifications() {\n    var dot = qs('#notif-dot');\n    var btn = qs('#btn-bell');\n    if (!btn) return;\n    var proto = (location.protocol === 'https:') ? 'wss://' : 'ws://';\n    var wsUrl = proto + location.host + '/ws/notifications/';\n    try {\n      var ws = new WebSocket(wsUrl);\n      ws.onopen = function () { /* conn ok */ };\n      ws.onmessage = function (evt) {\n        try {\n          var msg = JSON.parse(evt.data);\n          // minimal policy: show a dot on any message\n          if (dot) dot.classList.remove('hidden');\n          // Optional: toast UI could be added; we avoid inline HTML for CSP friendliness\n        } catch (_) {\n          if (dot) dot.classList.remove('hidden');\n        }\n      };\n      ws.onclose = function () { /* silent */ };\n      btn.addEventListener('click', function (e) {\n        if (dot) dot.classList.add('hidden');\n      });\n    } catch (_) {}\n  }\n\n  // Minimal fetch helper (CSRF-aware for future POSTs)\n  function getCookie(name) {\n    var value = '; ' + document.cookie;\n    var parts = value.split('; ' + name + '=');\n    if (parts.length === 2) return parts.pop().split(';').shift();\n  }\n  function ajax(url, opts) {\n    opts = opts || {};\n    opts.headers = opts.headers || {};\n    if ((opts.method || 'GET').toUpperCase() !== 'GET') {\n      var csrf = getCookie('csrftoken');\n      if (csrf) opts.headers['X-CSRFToken'] = csrf;\n    }\n    return fetch(url, opts);\n  }\n  window.PortalAjax = ajax;\n\n  function boot() {\n    // Ensure initial theme matches preference\n    setTheme(currentTheme());\n    initThemeToggle();\n    initMobileMenu();\n    initNotifications();\n    initUserMenu();\n    initStickySearch();\n    initFiltersDrawer();\n  }\n\n  if (document.readyState === 'loading') document.addEventListener('DOMContentLoaded', boot); else boot();\n})();\n\n// --- Portal UX Enhancements ---\n(function(){\n  function qs(sel, ctx) { return (ctx || document).querySelector(sel); }\n  function throttle(fn, wait){ let t=0; return function(){ const now=Date.now(); if(now-t>wait){ t=now; return fn.apply(this, arguments);} }; }\n\n  // Sticky compact search: shrink header and emphasize the inline search on scroll\n  window.initStickySearch = function(){\n    var header = qs('header');\n    var compacted = false;\n    if(!header) return;\n    var onScroll = throttle(function(){\n      var y = window.scrollY || window.pageYOffset || 0;\n      if (y > 80 && !compacted) {\n        compacted = true;\n        header.classList.add('shadow-lg');\n      } else if (y <= 80 && compacted) {\n        compacted = false;\n        header.classList.remove('shadow-lg');\n      }\n    }, 100);\n    window.addEventListener('scroll', onScroll, { passive: true });\n  }\n\n  // Filters drawer toggle on Browse Artists\n  window.initFiltersDrawer = function(){\n    var btn = qs('#btn-filters');\n    var drawer = qs('#filters-drawer');\n    if(!btn || !drawer) return;\n    btn.addEventListener('click', function(){\n      drawer.classList.toggle('hidden');\n    });\n  }\n})();\n\n// --- Toast Notifications for WebSocket messages ---\n(function(){\n  function qs(sel, ctx) { return (ctx || document).querySelector(sel); }\n  function makeToastContainer(){\n    var el = document.getElementById('toast-root');\n    if (el) return el;\n    el = document.createElement('div');\n    el.id = 'toast-root';\n    el.style.position = 'fixed';\n    el.style.right = '1rem';\n    el.style.bottom = '1rem';\n    el.style.zIndex = '9999';\n    document.body.appendChild(el);\n    return el;\n  }\n  function toast(msg){\n    var root = makeToastContainer();\n    var card = document.createElement('div');\n    card.className = 'mb-2 px-4 py-3 rounded-lg text-sm text-white shadow-lg bg-gradient-to-tr from-pink-600 to-fuchsia-600 opacity-0 translate-y-2 transition duration-300';\n    card.textContent = msg || 'Notification';\n    root.appendChild(card);\n    requestAnimationFrame(function(){ card.classList.remove('opacity-0','translate-y-2'); });\n    setTimeout(function(){ card.classList.add('opacity-0','translate-y-2'); setTimeout(function(){ card.remove(); }, 300); }, 4000);\n  }\n  // Hook into existing WebSocket handler by monkey-patching after initNotifications sets ws\n  var _oldInit = window.initNotifications;\n  window.initNotifications = function(){\n    var dot = qs('#notif-dot');\n    var btn = qs('#btn-bell');\n    var proto = (location.protocol === 'https:') ? 'wss://' : 'ws://';\n    var wsUrl = proto + location.host + '/ws/notifications/';\n    try {\n      var ws = new WebSocket(wsUrl);\n      ws.onmessage = function (evt) {\n        try { var msg = JSON.parse(evt.data); toast(msg.title || 'Update'); } catch (e) { toast('Update'); }\n        if (dot) dot.classList.remove('hidden');\n      };\n      ws.onopen = function(){}; ws.onclose=function(){};\n      if (btn) btn.addEventListener('click', function(){ if(dot) dot.classList.add('hidden'); });\n    } catch (_) {}\n  }\n})();\n"],
  "mappings": "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",
  "names": ["qs", "sel", "ctx", "qsa", "setTheme", "mode", "initUserMenu", "btn", "panel", "btnM", "panelM", "toggle", "el", "open", "close", "e", "t", "currentTheme", "initThemeToggle", "next", "initMobileMenu", "menu", "hidden", "initNotifications", "dot", "proto", "wsUrl", "ws", "evt", "msg", "getCookie", "name", "value", "parts", "ajax", "url", "opts", "csrf", "boot", "throttle", "fn", "wait", "now", "header", "compacted", "onScroll", "y", "drawer", "makeToastContainer", "toast", "root", "card", "_oldInit"]
}
