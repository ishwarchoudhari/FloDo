{
  "version": 3,
  "sources": ["../../js/auth.js"],
  "sourcesContent": ["// auth.js\n// AJAX functions for login, signup, logout using Fetch API.\n\nasync function loginUser(formData) {\n  const res = await fetchWithCSRF('/login/', {\n    method: 'POST',\n    body: formData,\n  });\n  return res.json();\n}\n\nasync function signupUser(formData) {\n  const res = await fetchWithCSRF('/signup/', {\n    method: 'POST',\n    body: formData,\n  });\n  return res.json();\n}\n\nasync function logoutUser() {\n  const res = await fetchWithCSRF('/logout/', {\n    method: 'POST',\n  });\n  return res.json();\n}\n\nwindow.loginUser = loginUser;\nwindow.signupUser = signupUser;\nwindow.logoutUser = logoutUser;\n\n// Attach login page interactions without inline JS\ndocument.addEventListener('DOMContentLoaded', () => {\n  const form = document.getElementById('loginForm');\n  if (!form) return; // not on login page\n\n  const loader = document.getElementById('loginLoader');\n  const errBox = document.getElementById('loginError');\n  const btn = document.getElementById('loginBtn');\n  const btnSpinner = document.getElementById('btnSpinner');\n  const btnText = document.getElementById('btnText');\n\n  function setBusy(state){\n    if (!btn || !btnSpinner || !btnText) return;\n    if(state){\n      btn.disabled = true; btn.classList.add('opacity-80','cursor-not-allowed');\n      btnSpinner.classList.remove('hidden'); btnText.textContent = 'Signing in\u2026';\n    } else {\n      btn.disabled = false; btn.classList.remove('opacity-80','cursor-not-allowed');\n      btnSpinner.classList.add('hidden'); btnText.textContent = 'Sign in';\n    }\n  }\n\n  form.addEventListener('submit', async (e) => {\n    e.preventDefault();\n    if (errBox) { errBox.classList.add('hidden'); errBox.textContent = ''; }\n    setBusy(true);\n    try {\n      const data = new FormData(form);\n      // Minimal client-side validation to avoid unnecessary requests\n      const username = (data.get('username') || '').trim();\n      const password = (data.get('password') || '');\n      if (!username || !password) {\n        if (errBox) { errBox.textContent = 'Please enter both username and password.'; errBox.classList.remove('hidden'); }\n        setBusy(false);\n        return;\n      }\n      const res = await loginUser(data);\n      if (res && res.success) {\n        if (window.updateAriaStatus) window.updateAriaStatus('Login successful. Redirecting to dashboard.');\n        if (loader) { loader.classList.remove('hidden'); loader.classList.add('flex'); }\n        if (form.parentElement) { form.parentElement.classList.add('opacity-0','translate-y-2'); }\n\n        // Show progress loading effect in the center during the 3s wait\n        try {\n          // Reuse if already present to avoid duplicate IDs\n          let loadingEl = document.getElementById('loading');\n          if (!loadingEl) {\n            loadingEl = document.createElement('div');\n            loadingEl.id = 'loading';\n            loadingEl.textContent = 'Please wait...';\n          }\n          // Host: use the centered container's parent of the card wrapper (safe selector)\n          // Structure: .min-h-[70vh] > .w-full.max-w-lg > .card > form\n          const cardWrapper = form && form.closest('.w-full.max-w-lg');\n          const host = (cardWrapper && cardWrapper.parentElement) || document.body;\n          // Hide the original card to avoid visual overlap\n          const card = form && form.parentElement ? form.parentElement : null;\n          if (card) { card.classList.add('hidden'); }\n          // Ensure loader is visible\n          loadingEl.classList.remove('hidden');\n          // Append loader if not already in DOM\n          if (!loadingEl.isConnected) host.appendChild(loadingEl);\n          // Optional: bring into view for smaller screens\n          try { loadingEl.scrollIntoView({ block: 'center', behavior: 'smooth' }); } catch(_){}\n        } catch(_) { /* no-op: graceful fallback */ }\n        setTimeout(() => {\n          window.location.href = res.redirect || '/dashboard/';\n        }, 3000);\n      } else {\n        const msg = (res && (res.error || res.detail)) || 'Invalid username or password';\n        if (errBox) { errBox.textContent = msg; errBox.classList.remove('hidden'); }\n        if (window.updateAriaStatus) window.updateAriaStatus('Login failed. ' + msg);\n        if (form.parentElement) {\n          form.parentElement.classList.add('motion-safe:animate-[shake_0.3s]');\n          setTimeout(()=> form.parentElement.classList.remove('motion-safe:animate-[shake_0.3s]'), 350);\n        }\n      }\n    } catch (ex) {\n      if (errBox) { errBox.textContent = 'Network error. Please try again.'; errBox.classList.remove('hidden'); }\n      if (window.updateAriaStatus) window.updateAriaStatus('Network error during login.');\n    } finally {\n      setBusy(false);\n    }\n  });\n});\n"],
  "mappings": "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",
  "names": ["loginUser", "formData", "signupUser", "logoutUser", "form", "loader", "errBox", "btn", "btnSpinner", "btnText", "setBusy", "state", "e", "data", "username", "password", "res", "loadingEl", "cardWrapper", "host", "card", "msg"]
}
