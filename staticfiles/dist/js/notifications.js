(()=>{(function(){function P(){try{let e=document.getElementById("content-root");if(!e||!e.classList.contains("md:ml-64")||!e.classList.contains("pt-16"))return;if(!document.getElementById("contentPaddingOverride")){let o=document.createElement("style");o.id="contentPaddingOverride",o.textContent="#content-root.pt-16{padding-top:6rem !important;}",document.head.appendChild(o)}}catch{}}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",P):P();let $=3e3,B="notifLastSeen",S="notifLastSeenId",m=typeof window<"u"&&window.DEBUG_NOTIF===!0;function l(){try{m&&typeof console<"u"&&console.debug&&console.debug("[notif]",...arguments)}catch{}}function w(e){return document.getElementById(e)}function y(e){return!e||typeof e!="string"?"?":e.trim().charAt(0).toUpperCase()}function b(e){try{let t=new Date(e),a=Math.max(0,Math.floor((new Date-t)/1e3));if(a<10)return"just now";if(a<60)return`${a}s ago`;let n=Math.floor(a/60);if(n<60)return`${n} min ago`;let r=Math.floor(n/60);if(r<24)return`${r} h ago`;let i=Math.floor(r/24);return i<7?`${i} d ago`:t.toLocaleString()}catch{return e}}async function T(e){try{let t=Date.now(),o=await fetch(`/dashboard/api/logs/?per_page=${e||10}&_=${t}`,{headers:{"X-Requested-With":"XMLHttpRequest"},credentials:"same-origin",cache:"no-store"});if(!o.ok)try{l("fetchRecent non-ok",{status:o.status})}catch{}let a=null;try{a=await o.json()}catch(n){try{l("fetchRecent json parse error",n)}catch{}}if(!a||!a.success){try{l("fetchRecent no data or success=false",a)}catch{}return[]}return a.results||[]}catch(t){try{l("fetchRecent failed",t)}catch{}return[]}}function L(e){if(!Array.isArray(e)||e.length===0)return[];let t=[],o=new Set;for(let a of e){let n=typeof a.id<"u"?`id:${a.id}`:`sig:${a.timestamp}|${a.action}|${a.table_name}|${a.row_id}|${a.admin_user}`;o.has(n)||(o.add(n),t.push(a))}return t}function C(){if(document.getElementById("notifGlowStyles"))return;let e=document.createElement("style");e.id="notifGlowStyles",e.textContent=`
@keyframes notifPulse{0%{box-shadow:0 0 0 0 rgba(59,130,246,.28)}70%{box-shadow:0 0 0 10px rgba(59,130,246,0)}100%{box-shadow:0 0 0 0 rgba(59,130,246,0)}}
@keyframes notifGlowOut{0%{background-color:rgba(59,130,246,0.06)}100%{background-color:transparent}}
.notif-new{background-color:rgba(59,130,246,0.06); animation:notifPulse 1800ms ease-out infinite}
.dark .notif-new{background-color:rgba(59,130,246,0.12)}
.notif-fade{animation:notifGlowOut 600ms ease-out 1}
/* Bell attention/fade visuals (SOC: notifications-only) */
#notifBtn svg{ transition: color 400ms ease, fill 800ms ease, stroke 400ms ease; }
.notif-bell-attn{ color:#FF9B00 !important; }
.notif-bell-attn path{ fill: rgba(255,155,0,0.25) !important; }
@keyframes notifBellFade { 0%{ color:#FF9B00; } 100%{ color:#374151; } }
@keyframes notifBellFillFade { 0%{ fill: rgba(255,155,0,0.25); } 100%{ fill: transparent; } }
.notif-bell-fade{ animation: notifBellFade 1200ms ease forwards; }
.notif-bell-fade path{ animation: notifBellFillFade 1200ms ease forwards; }
`,document.head.appendChild(e)}function u(e){let t=w("notifList"),o=w("notifEmpty");if(!t||!o)return;if(l("renderList",{count:e&&e.length||0}),t.innerHTML="",!e.length){o.classList.remove("hidden");return}o.classList.add("hidden"),C();let a=M(),n=new Set;if(e.length&&typeof e[0].id<"u"&&a.id)for(let i of e){if(String(i.id)===String(a.id))break;n.add(String(i.id))}let r=Date.now();e.forEach(i=>{let A=document.createElement("li"),Z=!(typeof i.id<"u"?n.has(String(i.id)):!1)&&a.ts?i.timestamp>a.ts:!1,z=!1;try{z=Math.abs(r-new Date(i.timestamp).getTime())<=60*1e3}catch{}let W=z;A.className=["p-3 rounded-lg border shadow-sm transition-all duration-200 hover:shadow-md hover:-translate-y-px will-change-transform","bg-white dark:bg-gray-800","border-gray-200 dark:border-gray-700","text-gray-900 dark:text-gray-100","hover:bg-white dark:hover:bg-gray-800",W?"notif-new":""].join(" ").trim();let K=i.admin_user||"Admin",f=(i.action||"").toUpperCase(),F=i.name||i.row_details&&i.row_details.name||"",v=i.city||i.row_details&&i.row_details.city||"",E=i.phone||i.row_details&&i.row_details.phone||"",_=i.row_id,V=(i.table_name||"").toString(),Y=i.row_details&&(i.row_details.status||i.row_details.application_status)||"",k=document.createElement("div");k.className="flex items-start gap-3";let x=document.createElement("div");if(x.className="w-12 h-12 rounded-full overflow-hidden bg-gray-300 flex items-center justify-center text-sm font-semibold shrink-0 shadow-sm",x.setAttribute("aria-hidden","true"),window.__admin_avatar_url){let s=document.createElement("img");s.src=window.__admin_avatar_url,s.alt="Avatar",s.loading="lazy",s.className="w-full h-full object-cover",x.appendChild(s)}else{let s=document.createElementNS("http://www.w3.org/2000/svg","svg");s.setAttribute("class","w-8 h-8 text-gray-600"),s.setAttribute("fill","currentColor"),s.setAttribute("viewBox","0 0 20 20"),s.setAttribute("aria-hidden","true");let c=document.createElementNS("http://www.w3.org/2000/svg","path");c.setAttribute("fill-rule","evenodd"),c.setAttribute("d","M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z"),c.setAttribute("clip-rule","evenodd"),s.appendChild(c),x.appendChild(s)}let N=document.createElement("div");N.className="flex-1 min-w-0";let I=document.createElement("div");I.className="text-[0.94rem] leading-5 sm:text-sm whitespace-normal break-words";let O=V==="Table6"||/artist\s*application/i.test(V),Q={CREATE:"applied",UPDATE:"status updated",APPROVE:"approved",REJECT:"rejected"};if(O&&f==="CREATE"){let s=document.createDocumentFragment(),c=document.createElement("span");if(c.className="font-semibold",c.textContent=F||"Applicant",s.appendChild(c),s.append(" applied for Artist Application"),_!=null){s.append(" \u2022 ID #");let d=document.createElement("span");d.className="font-normal",d.textContent=String(_),s.appendChild(d)}v&&s.append(" \u2022 "+v),E&&s.append(" \u2022 "+E),I.appendChild(s)}else if(O&&(f==="APPROVE"||f==="REJECT"||f==="UPDATE")){let s=document.createDocumentFragment();if(f==="APPROVE"||f==="REJECT"){let d=document.createElementNS("http://www.w3.org/2000/svg","svg");d.setAttribute("class",f==="APPROVE"?"w-4 h-4 text-emerald-600 inline-block align-[-2px] mr-1.5":"w-4 h-4 text-rose-600 inline-block align-[-2px] mr-1.5"),d.setAttribute("viewBox","0 0 20 20"),d.setAttribute("fill","currentColor"),d.setAttribute("aria-hidden","true");let g=document.createElementNS("http://www.w3.org/2000/svg","path");f==="APPROVE"?g.setAttribute("d","M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293A1 1 0 106.293 10.707l2 2a1 1 0 001.414 0l3.999-4z"):g.setAttribute("d","M10 18a8 8 0 100-16 8 8 0 000 16zm2.828-10.828a1 1 0 10-1.414-1.414L10 7.172 8.586 5.758a1 1 0 10-1.414 1.414L8.586 8.586 7.172 10a1 1 0 101.414 1.414L10 9.999l1.414 1.415A1 1 0 1012.828 10l-1.414-1.414 1.414-1.414z"),d.appendChild(g),s.appendChild(d)}let c=document.createElement("span");if(c.className="font-semibold",c.textContent=F||"Applicant",s.appendChild(c),s.append("'s application was "),f==="APPROVE")s.append("approved");else if(f==="REJECT")s.append("rejected");else{let d=(Y||"").toString().replace(/_/g," ").toLowerCase();s.append("updated"),d&&s.append(" to "+d)}if(_!=null){s.append(" \u2022 ID #");let d=document.createElement("span");d.className="font-normal",d.textContent=String(_),s.appendChild(d)}v&&s.append(" \u2022 "+v),E&&s.append(" \u2022 "+E),I.appendChild(s)}else{let s=O&&Q[f]||f.toLowerCase(),c=document.createDocumentFragment(),d=document.createElement("span");d.className="font-semibold",d.textContent=K,c.appendChild(d),c.append(" has ");let g=document.createElement("span");g.className="font-normal",g.textContent=s,c.appendChild(g),c.append(" ");let U=document.createElement("span");if(U.className="font-normal",U.textContent=F||"-",c.appendChild(U),_!=null){c.append(" with ID ");let p=document.createElement("span");p.className="font-normal",p.textContent=String(_),c.appendChild(p)}if(v){c.append(" from ");let p=document.createElement("span");p.className="font-normal",p.textContent=v,c.appendChild(p)}if(E){c.append(" with Phone ");let p=document.createElement("span");p.className="font-normal",p.textContent=E,c.appendChild(p)}c.append("."),I.appendChild(c)}let R=document.createElement("div");R.className="text-xs text-gray-500 dark:text-gray-400 mt-1",R.textContent=b(i.timestamp),N.appendChild(I),N.appendChild(R),k.appendChild(x),k.appendChild(N),A.appendChild(k),t.appendChild(A)})}function h(e){let t=w("notifBadge");if(t)if(l("updateBadge",{newCount:e}),e>0){t.textContent=String(e),t.classList.remove("hidden");try{let o=document.querySelector("#notifBtn svg");o&&(o.classList.add("notif-bell-attn"),o.classList.remove("notif-bell-fade"))}catch{}}else t.textContent="",t.classList.add("hidden")}function M(){try{return{id:localStorage.getItem(S)||"",ts:localStorage.getItem(B)||""}}catch{return{id:"",ts:""}}}function q(e){try{localStorage.setItem(S,e?String(e):"")}catch{}}function J(e){try{localStorage.setItem(B,e||"")}catch{}}function G(){try{return Date.now()<=(window.__autoPauseUntil||window.__tablesPauseUntil||0)}catch{return!1}}typeof window.__notifInFlight>"u"&&(window.__notifInFlight=!1);async function D(){if(G()){l("tick skipped: paused");return}if(window.__notifInFlight){l("tick skipped: in-flight");return}window.__notifInFlight=!0;try{let e=await T(10),t=L(e);u(t);let o=M(),a=0;if(t.length&&t[0]&&typeof t[0].id<"u"){let n=o.id;if(n)for(let r of t){if(String(r.id)===String(n))break;a++}else a=t.length;window.__notif_latest_id=t[0]?.id,window.__notif_latest_ts=t[0]?.timestamp}else{let n=o.ts,r=t[0]?.timestamp||n;a=n?t.filter(i=>i.timestamp>n).length:t.length,window.__notif_latest_ts=r,window.__notif_latest_id=void 0}h(a)}finally{try{window.__notifInFlight=!1}catch{}}}window.bumpNotificationsNow=function(){try{if(G()||window.__notifInFlight)return;window.__notifInFlight=!0,Promise.resolve(D()).catch(()=>{}).finally(()=>{try{window.__notifInFlight=!1}catch{}})}catch{}};function H(){let e=w("notifBtn"),t=w("notifMenu");if(!e||!t)return;if(e.getAttribute("data-notif-bound")==="1"){l("bell already bound");return}try{!t.classList.contains("is-open")&&!t.classList.contains("is-closed")&&t.classList.add("is-closed")}catch{}function o(){if(t.classList.contains("is-open")&&!t.classList.contains("hidden"))return;l("openMenu"),t.classList.remove("hidden"),requestAnimationFrame(()=>{t.classList.add("is-open"),t.classList.remove("is-closed")});try{e.setAttribute("aria-expanded","true")}catch{}try{window.__notif_menu_opened_at=Date.now()}catch{}let n=window.__notif_latest_id,r=window.__notif_latest_ts;typeof n<"u"&&n!==null&&q(n),r&&J(r);try{let i=document.querySelector("#notifBtn svg");i&&(i.classList.remove("notif-bell-attn"),i.offsetWidth,i.classList.add("notif-bell-fade"),i.addEventListener("animationend",function A(){try{i.classList.remove("notif-bell-fade")}catch{}i.removeEventListener("animationend",A)}))}catch{}h(0)}function a(){if(t.classList.contains("hidden")&&!t.classList.contains("is-open"))return;l("closeMenu"),t.classList.remove("is-open"),t.classList.add("is-closed"),setTimeout(()=>{try{t.classList.add("hidden")}catch{}},170);try{e.setAttribute("aria-expanded","false")}catch{}}e.addEventListener("click",n=>{l("btn click"),n&&typeof n.preventDefault=="function"&&n.preventDefault(),n&&typeof n.stopImmediatePropagation=="function"&&n.stopImmediatePropagation(),t.classList.contains("hidden")?o():a()}),t.addEventListener("click",n=>{n.stopPropagation()}),window.__notif_doc_bound||(document.addEventListener("click",n=>{try{let r=n.target;if(e.contains(r)||t.contains(r))return;l("outside click -> close"),a()}catch{}}),window.__notif_doc_bound=!0),window.__notif_escape_bound||(document.addEventListener("keydown",n=>{n.key==="Escape"&&a()}),window.__notif_escape_bound=!0);try{e.setAttribute("data-notif-bound","1")}catch{}}function j(){if(w("notifBtn")){H();try{window.noteGlobalActivity||(window.noteGlobalActivity=function(){try{let t=Date.now();typeof window.__autoPauseUntil>"u"&&(window.__autoPauseUntil=0),window.__autoPauseUntil=t+18e4,window.__tablesInactivityTimer&&(clearTimeout(window.__tablesInactivityTimer),window.__tablesInactivityTimer=null)}catch{}},document.addEventListener("input",function(t){let o=t&&t.target;o&&o.matches&&o.matches('input, textarea, select, [contenteditable="true"]')&&window.noteGlobalActivity()}),document.addEventListener("click",function(t){let o=t&&t.target&&t.target.closest&&t.target.closest("button, a");if(!o)return;let a=(o.textContent||"").toLowerCase();(o.getAttribute&&(o.getAttribute("data-action")||o.getAttribute("onclick"))||/add|edit|update|delete|save|action|search/.test(a))&&window.noteGlobalActivity()}),document.addEventListener("focusin",function(t){let o=t&&t.target;o&&o.matches&&o.matches('input, textarea, select, [contenteditable="true"]')&&window.noteGlobalActivity()}))}catch{}D().catch(()=>{}).finally(()=>{try{window.__notifInFlight=!1}catch{}}),setInterval(function(){Promise.resolve(D()).finally(()=>{})},$)}}window.__notif_inited?l("notifications already initialized"):document.readyState==="loading"?document.addEventListener("DOMContentLoaded",function(){window.__notif_inited||(j(),window.__notif_inited=!0)}):(j(),window.__notif_inited=!0)})();(function(){try{let m=function(){try{S&&typeof console<"u"&&console.debug&&console.debug("[notif-ws]",...arguments)}catch{}},L=function(){let u=b;b=Math.min(T,Math.floor(b*1.8)),m("reconnect in ms",u),setTimeout(C,u)},C=function(){try{m("connecting",w),y=new WebSocket(w),y.onopen=function(){m("connected"),b=1e3},y.onmessage=function(u){try{let h=JSON.parse(u.data||"{}");if(h&&h.type==="activity_log"){try{window.__notif_latest_ts=h.data&&h.data.timestamp||new Date().toISOString()}catch{}typeof window.bumpNotificationsNow=="function"&&window.bumpNotificationsNow()}}catch(h){m("onmessage parse error",h)}},y.onerror=function(u){m("ws error",u)},y.onclose=function(){m("closed"),L()}}catch(u){m("connect error",u),L()}};var P=m,$=L,B=C;if(window.__notif_ws_inited)return;window.__notif_ws_inited=!0;let S=typeof window<"u"&&window.DEBUG_NOTIF===!0,w=`${location.protocol==="https:"?"wss":"ws"}://${location.host}/ws/notifications/`,y=null,b=1e3,T=2e4;setTimeout(C,250)}catch{}})();})();
//# sourceMappingURL=notifications.js.map
