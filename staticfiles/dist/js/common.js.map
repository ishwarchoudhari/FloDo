{
  "version": 3,
  "sources": ["../../js/common.js"],
  "sourcesContent": ["// common.js\n// Utility helpers shared across the app.\n\n// Get CSRF token from cookie (Django default)\nfunction getCookie(name) {\n  let cookieValue = null;\n  if (document.cookie && document.cookie !== '') {\n    const cookies = document.cookie.split(';');\n    for (let i = 0; i < cookies.length; i++) {\n      const cookie = cookies[i].trim();\n      if (cookie.substring(0, name.length + 1) === (name + '=')) {\n        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));\n        break;\n      }\n    }\n  }\n  return cookieValue;\n}\n\n// Toggle dropdowns by id\nfunction toggleDropdown(elementId) {\n  const el = document.getElementById(elementId);\n  if (!el) return;\n  el.classList.toggle('hidden');\n}\n\n// Toast queue and centered placement to avoid overlapping header dropdown\nconst __toastQueue = [];\nlet __toastActive = false;\n\nfunction __getToastContainer(){\n  let c = document.getElementById('toastContainer');\n  if (!c){\n    c = document.createElement('div');\n    c.id = 'toastContainer';\n    c.className = 'fixed top-4 left-0 right-0 z-50 flex justify-center items-start pointer-events-none';\n    document.body.appendChild(c);\n  }\n  return c;\n}\n\nfunction __renderToast(message, type, details){\n  let color = 'bg-blue-600';\n  let icon = '\u2139\uFE0F';\n  if (type === 'success') { color = 'bg-green-600'; icon = '\u2714\uFE0F'; }\n  if (type === 'error') { color = 'bg-red-600'; icon = '\u26A0\uFE0F'; }\n  const wrapper = document.createElement('div');\n  wrapper.className = 'pointer-events-auto';\n  const div = document.createElement('div');\n  div.setAttribute('role', 'status');\n  div.setAttribute('aria-live', 'polite');\n  div.className = `${color} text-white px-4 py-3 rounded shadow-lg max-w-sm w-[min(92vw,28rem)]`; // centered card\n  div.innerHTML = `\n    <div class=\"flex items-start gap-2\">\n      <span class=\"text-lg leading-none\">${icon}</span>\n      <div class=\"flex-1\">\n        <div class=\"font-medium\">${message}</div>\n        ${details ? `<div class=\"opacity-90 text-sm mt-0.5\">${details}</div>` : ''}\n      </div>\n    </div>`;\n  // animation\n  wrapper.style.transition = 'transform 220ms ease, opacity 220ms ease';\n  wrapper.style.transform = 'translateY(-10px)';\n  wrapper.style.opacity = '0';\n  const container = __getToastContainer();\n  container.appendChild(wrapper);\n  wrapper.appendChild(div);\n  // enter\n  requestAnimationFrame(() => {\n    wrapper.style.transform = 'translateY(0)';\n    wrapper.style.opacity = '1';\n  });\n  const timeout = setTimeout(() => __dismissToast(wrapper), 3000);\n  wrapper.addEventListener('click', () => {\n    clearTimeout(timeout);\n    __dismissToast(wrapper);\n  });\n}\n\nfunction __dismissToast(wrapper){\n  wrapper.style.transform = 'translateY(-10px)';\n  wrapper.style.opacity = '0';\n  setTimeout(() => {\n    wrapper.remove();\n    __toastActive = false;\n    __drainToastQueue();\n  }, 220);\n}\n\nfunction __drainToastQueue(){\n  if (__toastActive) return;\n  const next = __toastQueue.shift();\n  if (!next) return;\n  __toastActive = true;\n  __renderToast(next.message, next.type, next.details);\n}\n\n// Simple notification banner with optional details (public API)\nfunction showNotification(message, type = 'info', details = '') {\n  __toastQueue.push({ message, type, details });\n  __drainToastQueue();\n}\n\nwindow.getCookie = getCookie;\nwindow.toggleDropdown = toggleDropdown;\nwindow.showNotification = showNotification;\n\n// Lightweight global loading indicator (top progress bar)\nlet __loadingCount = 0;\nlet __loadingTimer = null;\nfunction __ensureProgressBar(){\n  let bar = document.getElementById('globalProgressBar');\n  if (!bar){\n    bar = document.createElement('div');\n    bar.id = 'globalProgressBar';\n    bar.className = 'fixed top-0 left-0 h-0.5 bg-blue-600 dark:bg-blue-400 z-[60] transition-[width,opacity] duration-300 ease-out';\n    bar.style.width = '0%';\n    bar.style.opacity = '0';\n    document.body.appendChild(bar);\n  }\n  return bar;\n}\nfunction startLoading(){\n  const bar = __ensureProgressBar();\n  __loadingCount++;\n  if (__loadingCount === 1){\n    // reset and start animating to 80%\n    bar.style.opacity = '1';\n    bar.style.width = '0%';\n    // small delay to allow CSS to register width reset\n    requestAnimationFrame(()=>{\n      bar.style.width = '80%';\n    });\n    // safety timer to avoid hanging bar\n    if (__loadingTimer) clearTimeout(__loadingTimer);\n    __loadingTimer = setTimeout(()=>{ bar.style.width = '90%'; }, 4000);\n  }\n}\nfunction stopLoading(){\n  const bar = __ensureProgressBar();\n  __loadingCount = Math.max(0, __loadingCount - 1);\n  if (__loadingCount === 0){\n    if (__loadingTimer) { clearTimeout(__loadingTimer); __loadingTimer = null; }\n    // finish to 100% then fade out\n    bar.style.width = '100%';\n    setTimeout(()=>{ bar.style.opacity = '0'; }, 200);\n    setTimeout(()=>{ bar.style.width = '0%'; }, 600);\n  }\n}\nasync function withLoading(promise){\n  try { startLoading(); return await promise; } finally { stopLoading(); }\n}\n\nwindow.startLoading = startLoading;\nwindow.stopLoading = stopLoading;\nwindow.withLoading = withLoading;\n\n// Intercept logout form to use AJAX endpoint and redirect cleanly\ndocument.addEventListener('DOMContentLoaded', () => {\n  const form = document.getElementById('logoutForm');\n  if (form) {\n    form.addEventListener('submit', async (e) => {\n      e.preventDefault();\n      try {\n        const res = await fetch(form.getAttribute('action') || '/logout/', { method: 'POST', headers: { 'X-CSRFToken': getCookie('csrftoken') } });\n        const data = await res.json();\n        window.location.href = (data && data.redirect) ? data.redirect : '/login/';\n      } catch (err) {\n        window.location.href = '/login/';\n      }\n    });\n  }\n});\n\n// Unique ID generation (5-char alphanumeric) and persistent mapping\nfunction generateUniqueID() {\n  const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';\n  let result = '';\n  for (let i = 0; i < 5; i++) {\n    result += chars.charAt(Math.floor(Math.random() * chars.length));\n  }\n  return result;\n}\n\nfunction _loadUidMap(){\n  try { return JSON.parse(localStorage.getItem('uidMap') || '{}'); } catch { return {}; }\n}\n\nfunction _saveUidMap(map){\n  try { localStorage.setItem('uidMap', JSON.stringify(map)); } catch {}\n}\n\n// Returns persistent UID for a stable key; generates if missing and guarantees uniqueness within the map\nfunction getPersistentUID(stableKey){\n  const map = _loadUidMap();\n  if (map[stableKey]) return map[stableKey];\n  let candidate = generateUniqueID();\n  const values = new Set(Object.values(map));\n  while (values.has(candidate)) candidate = generateUniqueID();\n  map[stableKey] = candidate;\n  _saveUidMap(map);\n  return candidate;\n}\n\nwindow.generateUniqueID = generateUniqueID;\nwindow.getPersistentUID = getPersistentUID;\n\n\n// Wrapper around fetch that injects Django CSRF header for same-origin, non-GET requests\nasync function fetchWithCSRF(input, init){\n  init = init || {};\n  const method = (init.method || 'GET').toUpperCase();\n  const isSafe = method === 'GET' || method === 'HEAD' || method === 'OPTIONS' || method === 'TRACE';\n  const url = (typeof input === 'string') ? input : (input && input.url) || '';\n  const isSameOrigin = !/^https?:\\/\\//i.test(url) || url.indexOf(location.origin) === 0;\n  if (isSameOrigin && !isSafe){\n    init.headers = init.headers || {};\n    if (!(init.headers instanceof Headers)){\n      // Plain object, safe to mutate\n      if (!init.headers['X-CSRFToken']) init.headers['X-CSRFToken'] = getCookie('csrftoken');\n      if (!init.headers['X-Requested-With']) init.headers['X-Requested-With'] = 'XMLHttpRequest';\n    } else {\n      if (!init.headers.has('X-CSRFToken')) init.headers.set('X-CSRFToken', getCookie('csrftoken'));\n      if (!init.headers.has('X-Requested-With')) init.headers.set('X-Requested-With', 'XMLHttpRequest');\n    }\n    init.credentials = init.credentials || 'same-origin';\n  }\n  return fetch(input, init);\n}\n\nwindow.fetchWithCSRF = fetchWithCSRF;\n\n"],
  "mappings": "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",
  "names": ["getCookie", "name", "cookieValue", "cookies", "i", "cookie", "toggleDropdown", "elementId", "el", "__toastQueue", "__toastActive", "__getToastContainer", "c", "__renderToast", "message", "type", "details", "color", "icon", "wrapper", "div", "timeout", "__dismissToast", "__drainToastQueue", "next", "showNotification", "__loadingCount", "__loadingTimer", "__ensureProgressBar", "bar", "startLoading", "stopLoading", "withLoading", "promise", "form", "e", "data", "generateUniqueID", "chars", "result", "_loadUidMap", "_saveUidMap", "map", "getPersistentUID", "stableKey", "candidate", "values", "fetchWithCSRF", "input", "init", "method", "isSafe", "url"]
}
